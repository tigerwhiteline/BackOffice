<script>
  const apiUrl = "https://script.google.com/macros/s/AKfycbyCImszIzNymu3Zp1ofGI1LAv07tKT3sVmuRg6vCLgyBwS6Vb_Bc9EccS4HiPXRU9yl/exec";

  async function checkAttendance() {
    const date = document.getElementById('date').value;
    const staffName = document.getElementById('staffName').value;

    document.getElementById('loading').style.display = 'block';

    const response = await fetch(`${apiUrl}?action=checkAttendance&date=${date}&staffName=${staffName}`);
    const result = await response.json();

    document.getElementById('loading').style.display = 'none';
    document.getElementById('clockInBtn').style.display = result.exists && !result.clockIn ? 'block' : 'none';
    document.getElementById('clockOutBtn').style.display = result.exists && !result.clockOut ? 'block' : 'none';

    document.getElementById('statusMessage').innerText = result.exists
      ? result.clockIn
        ? result.clockOut
          ? "ลงชื่อเข้าและออกเรียบร้อยแล้ว"
          : "กรุณาลงชื่อออกงาน"
        : "กรุณาลงชื่อเข้างาน"
      : "ไม่มีข้อมูล กรุณาลงชื่อเข้างาน";
  }

  async function clockInOrOut(type) {
    const date = document.getElementById('date').value;
    const staffName = document.getElementById('staffName').value;

    const response = await fetch(`${apiUrl}?action=recordAttendance&type=${type}&date=${date}&staffName=${staffName}`, {
      method: 'POST',
    });
    const result = await response.json();

    if (result.success) {
      alert(type === 'in' ? 'Clock In สำเร็จ!' : 'Clock Out สำเร็จ!');
      checkAttendance();
    }
  }

  function clockIn() {
    clockInOrOut("in");
  }

  function clockOut() {
    clockInOrOut("out");
  }
</script>
